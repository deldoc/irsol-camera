<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IRSOL: irsol::server::frame_collector::FrameCollector Class Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../irsol_logo.jpeg"/></td>
  <td id="projectalign">
   <div id="projectname">IRSOL
   </div>
   <div id="projectbrief">C++ code implementing socket server for interacting with Baumer camera.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="../../d0/d9b/classirsol_1_1server_1_1frame__collector_1_1FrameCollector-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">irsol::server::frame_collector::FrameCollector Class Reference<div class="ingroups"><a class="el" href="../../de/dd4/group__FrameCollector.html">FrameCollector</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Coordinates frame acquisition from a camera and distributes frames to registered clients.  
 <a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a8c8cef36ff52c80e1f28197618817491" id="r_a8c8cef36ff52c80e1f28197618817491"><td class="memItemLeft" align="right" valign="top">using&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">frame_queue_t</a> = <a class="el" href="../../d5/d11/structirsol_1_1server_1_1frame__collector_1_1ClientCollectionParams.html#a97ded264be77859ad00b2a078f1ffeac">ClientCollectionParams::frame_queue_t</a></td></tr>
<tr class="separator:a8c8cef36ff52c80e1f28197618817491"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8be6ebec2ed0d3f0a78b001c810c4108" id="r_a8be6ebec2ed0d3f0a78b001c810c4108"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8be6ebec2ed0d3f0a78b001c810c4108">FrameCollector</a> (<a class="el" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html">irsol::camera::Interface</a> &amp;camera)</td></tr>
<tr class="memdesc:a8be6ebec2ed0d3f0a78b001c810c4108"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs a <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html" title="Coordinates frame acquisition from a camera and distributes frames to registered clients.">FrameCollector</a> for the given camera interface.  <br /></td></tr>
<tr class="separator:a8be6ebec2ed0d3f0a78b001c810c4108"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6cf04e668547b974523bc0b43bcb9298" id="r_a6cf04e668547b974523bc0b43bcb9298"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a6cf04e668547b974523bc0b43bcb9298">~FrameCollector</a> ()</td></tr>
<tr class="memdesc:a6cf04e668547b974523bc0b43bcb9298"><td class="mdescLeft">&#160;</td><td class="mdescRight">Destructor. Stops any running threads and cleans up resources.  <br /></td></tr>
<tr class="separator:a6cf04e668547b974523bc0b43bcb9298"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2eda10c577b209e3635abd108b69318d" id="r_a2eda10c577b209e3635abd108b69318d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a2eda10c577b209e3635abd108b69318d">start</a> ()</td></tr>
<tr class="memdesc:a2eda10c577b209e3635abd108b69318d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the frame collection and distribution thread.  <br /></td></tr>
<tr class="separator:a2eda10c577b209e3635abd108b69318d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae06173b3a37b853384004250cbdc2a16" id="r_ae06173b3a37b853384004250cbdc2a16"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ae06173b3a37b853384004250cbdc2a16">stop</a> ()</td></tr>
<tr class="memdesc:ae06173b3a37b853384004250cbdc2a16"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops the frame collector and joins worker threads.  <br /></td></tr>
<tr class="separator:ae06173b3a37b853384004250cbdc2a16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa1aad4f54c265bc5c2771ff9d79b6123" id="r_aa1aad4f54c265bc5c2771ff9d79b6123"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa1aad4f54c265bc5c2771ff9d79b6123">isBusy</a> () const</td></tr>
<tr class="memdesc:aa1aad4f54c265bc5c2771ff9d79b6123"><td class="mdescLeft">&#160;</td><td class="mdescRight">Checks whether the collector is currently serving any clients.  <br /></td></tr>
<tr class="separator:aa1aad4f54c265bc5c2771ff9d79b6123"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82c78c2d8c59c360184a852b5b53f101" id="r_a82c78c2d8c59c360184a852b5b53f101"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a82c78c2d8c59c360184a852b5b53f101">registerClient</a> (<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> clientId, double fps, std::shared_ptr&lt; <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">frame_queue_t</a> &gt; queue, int64_t frameCount=-1)</td></tr>
<tr class="memdesc:a82c78c2d8c59c360184a852b5b53f101"><td class="mdescLeft">&#160;</td><td class="mdescRight">Registers a client to receive frames at a specified frame rate.  <br /></td></tr>
<tr class="separator:a82c78c2d8c59c360184a852b5b53f101"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a270f12597aa6816da16db8acf71a3bf1" id="r_a270f12597aa6816da16db8acf71a3bf1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a270f12597aa6816da16db8acf71a3bf1">deregisterClient</a> (<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> clientId)</td></tr>
<tr class="memdesc:a270f12597aa6816da16db8acf71a3bf1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deregisters a client and stops frame delivery.  <br /></td></tr>
<tr class="separator:a270f12597aa6816da16db8acf71a3bf1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:af7b64373a4ab41a14089e39de5b40245" id="r_af7b64373a4ab41a14089e39de5b40245"><td class="memItemLeft" align="right" valign="top">static std::shared_ptr&lt; <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">frame_queue_t</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#af7b64373a4ab41a14089e39de5b40245">makeQueuePtr</a> ()</td></tr>
<tr class="memdesc:af7b64373a4ab41a14089e39de5b40245"><td class="mdescLeft">&#160;</td><td class="mdescRight">Utility static function to create a shared pointer to a frame queue.  <br /></td></tr>
<tr class="separator:af7b64373a4ab41a14089e39de5b40245"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-attribs" name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:ad7ab4acc72d3fad2bf71f6aa79b47a97" id="r_ad7ab4acc72d3fad2bf71f6aa79b47a97"><td class="memItemLeft" align="right" valign="top">static constexpr <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a0ed53497239b16c18f07550a1473a445">irsol::types::duration_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ad7ab4acc72d3fad2bf71f6aa79b47a97">SLACK</a> = std::chrono::milliseconds(50)</td></tr>
<tr class="memdesc:ad7ab4acc72d3fad2bf71f6aa79b47a97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Slack window for batching frame delivery to clients.  <br /></td></tr>
<tr class="separator:ad7ab4acc72d3fad2bf71f6aa79b47a97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a128380895ffbc5b1d34db2dcdd5cecb0" id="r_a128380895ffbc5b1d34db2dcdd5cecb0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a128380895ffbc5b1d34db2dcdd5cecb0">run</a> ()</td></tr>
<tr class="memdesc:a128380895ffbc5b1d34db2dcdd5cecb0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Runs the frame distribution loop in a background thread.  <br /></td></tr>
<tr class="separator:a128380895ffbc5b1d34db2dcdd5cecb0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a8dab8e90db2c693d5ddd528a3c851c" id="r_a3a8dab8e90db2c693d5ddd528a3c851c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a3a8dab8e90db2c693d5ddd528a3c851c">deregisterClientNonThreadSafe</a> (<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> clientId)</td></tr>
<tr class="memdesc:a3a8dab8e90db2c693d5ddd528a3c851c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Deregisters a client and stops frame delivery (not thread-safe).  <br /></td></tr>
<tr class="separator:a3a8dab8e90db2c693d5ddd528a3c851c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6230358201977df4fc63be18ed0719ac" id="r_a6230358201977df4fc63be18ed0719ac"><td class="memItemLeft" align="right" valign="top">std::pair&lt; std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> &gt;, std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a6230358201977df4fc63be18ed0719ac">collectReadyClients</a> (<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> now, <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a0ed53497239b16c18f07550a1473a445">irsol::types::duration_t</a> slack) const</td></tr>
<tr class="memdesc:a6230358201977df4fc63be18ed0719ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Collects clients who are scheduled to receive a frame at the given time.  <br /></td></tr>
<tr class="separator:a6230358201977df4fc63be18ed0719ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa8ed51e3c3dbcbb7395f8a78ecd0c4a" id="r_afa8ed51e3c3dbcbb7395f8a78ecd0c4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#afa8ed51e3c3dbcbb7395f8a78ecd0c4a">cleanUpSchedule</a> (const std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> &gt; schedules)</td></tr>
<tr class="memdesc:afa8ed51e3c3dbcbb7395f8a78ecd0c4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes schedules from the schedule map.  <br /></td></tr>
<tr class="separator:afa8ed51e3c3dbcbb7395f8a78ecd0c4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adedefafaa21f9005668569913caaac0c" id="r_adedefafaa21f9005668569913caaac0c"><td class="memItemLeft" align="right" valign="top">std::optional&lt; std::pair&lt; <a class="el" href="../../da/d77/structirsol_1_1server_1_1frame__collector_1_1FrameMetadata.html">FrameMetadata</a>, std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#ae50d5e590e95d2c56f3ba94a4f07a1aa">irsol::types::byte_t</a> &gt; &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#adedefafaa21f9005668569913caaac0c">grabImageData</a> () const</td></tr>
<tr class="memdesc:adedefafaa21f9005668569913caaac0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Captures an image and returns it along with associated metadata.  <br /></td></tr>
<tr class="separator:adedefafaa21f9005668569913caaac0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9e2cbc309a05bf63f708e0df24134500" id="r_a9e2cbc309a05bf63f708e0df24134500"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a> (const <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> &amp;clientId, <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> nextFrameDue)</td></tr>
<tr class="memdesc:a9e2cbc309a05bf63f708e0df24134500"><td class="mdescLeft">&#160;</td><td class="mdescRight">Schedules the next frame delivery for a client.  <br /></td></tr>
<tr class="separator:a9e2cbc309a05bf63f708e0df24134500"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a89aff071a1e8bb9c5775575c6ec963b8" id="r_a89aff071a1e8bb9c5775575c6ec963b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html">irsol::camera::Interface</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a89aff071a1e8bb9c5775575c6ec963b8">m_cam</a></td></tr>
<tr class="memdesc:a89aff071a1e8bb9c5775575c6ec963b8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the camera interface used for capturing.  <br /></td></tr>
<tr class="separator:a89aff071a1e8bb9c5775575c6ec963b8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed68d05a46f603193623ac19015033b6" id="r_aed68d05a46f603193623ac19015033b6"><td class="memItemLeft" align="right" valign="top">std::mutex&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aed68d05a46f603193623ac19015033b6">m_clientsMutex</a></td></tr>
<tr class="memdesc:aed68d05a46f603193623ac19015033b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Protects access to m_clients and m_scheduleMap.  <br /></td></tr>
<tr class="separator:aed68d05a46f603193623ac19015033b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa625ad14ab3b7d73d535adc4339aead0" id="r_aa625ad14ab3b7d73d535adc4339aead0"><td class="memItemLeft" align="right" valign="top">std::unordered_map&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>, <a class="el" href="../../d5/d11/structirsol_1_1server_1_1frame__collector_1_1ClientCollectionParams.html">ClientCollectionParams</a> &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a></td></tr>
<tr class="memdesc:aa625ad14ab3b7d73d535adc4339aead0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores parameters for each registered client.  <br /></td></tr>
<tr class="separator:aa625ad14ab3b7d73d535adc4339aead0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65026725325000ef733111870bef4ea4" id="r_a65026725325000ef733111870bef4ea4"><td class="memItemLeft" align="right" valign="top">std::map&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a>, std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a></td></tr>
<tr class="memdesc:a65026725325000ef733111870bef4ea4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps timestamps to client IDs scheduled at that time.  <br /></td></tr>
<tr class="separator:a65026725325000ef733111870bef4ea4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a705254fa30d424a01adb204078c00b2d" id="r_a705254fa30d424a01adb204078c00b2d"><td class="memItemLeft" align="right" valign="top">std::condition_variable&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a></td></tr>
<tr class="memdesc:a705254fa30d424a01adb204078c00b2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Signals when a new client is scheduled.  <br /></td></tr>
<tr class="separator:a705254fa30d424a01adb204078c00b2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b75eeab69b857b5a55261117b733205" id="r_a4b75eeab69b857b5a55261117b733205"><td class="memItemLeft" align="right" valign="top">std::thread&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a4b75eeab69b857b5a55261117b733205">m_distributorThread</a></td></tr>
<tr class="memdesc:a4b75eeab69b857b5a55261117b733205"><td class="mdescLeft">&#160;</td><td class="mdescRight">Thread responsible for frame distribution.  <br /></td></tr>
<tr class="separator:a4b75eeab69b857b5a55261117b733205"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01788beed29fbd39b3c7c6fd799dea1c" id="r_a01788beed29fbd39b3c7c6fd799dea1c"><td class="memItemLeft" align="right" valign="top">std::atomic&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a></td></tr>
<tr class="memdesc:a01788beed29fbd39b3c7c6fd799dea1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Indicates whether the collector is stopping due to an external request.  <br /></td></tr>
<tr class="separator:a01788beed29fbd39b3c7c6fd799dea1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Coordinates frame acquisition from a camera and distributes frames to registered clients. </p>
<p>The <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html" title="Coordinates frame acquisition from a camera and distributes frames to registered clients.">FrameCollector</a> class is responsible for orchestrating the acquisition of frames from a camera device and distributing those frames to multiple registered clients. Each client can specify its desired frame rate and the number of frames it wishes to receive. The collector ensures that frames are delivered to clients according to their schedules, batching requests within a configurable "slack" window to optimize camera usage and minimize redundant captures. For instance, if multiple clients are scheduled to receive frames at similar times, a single frame image is requested from the camera and distributed to all those clients.</p>
<p>The collector maintains a background thread that monitors client schedules, captures frames just-in-time, and pushes them into client-specific <a class="el" href="../../dc/d49/classirsol_1_1utils_1_1SafeQueue.html">irsol::utils::SafeQueue</a>. Clients can consume frames from these queues at their own pace. When a client has received its requested number of frames, it is automatically deregistered and its queue is marked as complete.</p>
<p>The scheduling strategy is as follows:</p><ul>
<li>Each client registers with a desired frame rate (fps) and frame count.</li>
<li>The collector maintains a schedule of when each client is next due to receive a frame.</li>
<li>When the earliest scheduled time arrives (or is within the allowed slack), the collector captures a single frame and distributes it to all clients whose schedules fall within the slack window.</li>
<li>This batching reduces redundant camera captures and ensures efficient resource usage.</li>
<li>The collector supports dynamic registration and deregistration of clients at runtime.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The current scheduling strategy can be extended or modified. For example, one might restrict allowed FPS values to multiples of 0.125s (i.e., FPS = 0.125, 0.25, 0.5, 1, 2, 4, 8, 16). In this approach, the <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html" title="Coordinates frame acquisition from a camera and distributes frames to registered clients.">FrameCollector</a> would continuously capture frames at the highest frame rate required by any connected client, without scheduling individual capture times. A delivery selection mechanism could then be implemented to determine which captured frames are delivered to which clients, simplifying the scheduling logic and potentially improving efficiency.</dd></dl>
<p>Thread safety: All public methods are thread-safe unless otherwise noted. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00069">69</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>
</div><h2 class="groupheader">Member Typedef Documentation</h2>
<a id="a8c8cef36ff52c80e1f28197618817491" name="a8c8cef36ff52c80e1f28197618817491"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8c8cef36ff52c80e1f28197618817491">&#9670;&#160;</a></span>frame_queue_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">using <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">irsol::server::frame_collector::FrameCollector::frame_queue_t</a> =  <a class="el" href="../../d5/d11/structirsol_1_1server_1_1frame__collector_1_1ClientCollectionParams.html#a97ded264be77859ad00b2a078f1ffeac">ClientCollectionParams::frame_queue_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00072">72</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8be6ebec2ed0d3f0a78b001c810c4108" name="a8be6ebec2ed0d3f0a78b001c810c4108"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8be6ebec2ed0d3f0a78b001c810c4108">&#9670;&#160;</a></span>FrameCollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">irsol::server::frame_collector::FrameCollector::FrameCollector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html">irsol::camera::Interface</a> &amp;&#160;</td>
          <td class="paramname"><em>camera</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructs a <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html" title="Coordinates frame acquisition from a camera and distributes frames to registered clients.">FrameCollector</a> for the given camera interface. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">camera</td><td>Reference to a camera interface for capturing frames. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00021">21</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   21</span>                                                          : <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a89aff071a1e8bb9c5775575c6ec963b8">m_cam</a>(camera)</div>
<div class="line"><span class="lineno">   22</span>{</div>
<div class="line"><span class="lineno">   23</span>  <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a2eda10c577b209e3635abd108b69318d">start</a>();</div>
<div class="line"><span class="lineno">   24</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a2eda10c577b209e3635abd108b69318d"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a2eda10c577b209e3635abd108b69318d">irsol::server::frame_collector::FrameCollector::start</a></div><div class="ttdeci">void start()</div><div class="ttdoc">Starts the frame collection and distribution thread.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00032">collector.cpp:32</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a89aff071a1e8bb9c5775575c6ec963b8"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a89aff071a1e8bb9c5775575c6ec963b8">irsol::server::frame_collector::FrameCollector::m_cam</a></div><div class="ttdeci">irsol::camera::Interface &amp; m_cam</div><div class="ttdoc">Reference to the camera interface used for capturing.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00214">collector.hpp:214</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6cf04e668547b974523bc0b43bcb9298" name="a6cf04e668547b974523bc0b43bcb9298"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6cf04e668547b974523bc0b43bcb9298">&#9670;&#160;</a></span>~FrameCollector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">irsol::server::frame_collector::FrameCollector::~FrameCollector </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Destructor. Stops any running threads and cleans up resources. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00026">26</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   27</span>{</div>
<div class="line"><span class="lineno">   28</span>  <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ae06173b3a37b853384004250cbdc2a16">stop</a>();</div>
<div class="line"><span class="lineno">   29</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_ae06173b3a37b853384004250cbdc2a16"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ae06173b3a37b853384004250cbdc2a16">irsol::server::frame_collector::FrameCollector::stop</a></div><div class="ttdeci">void stop()</div><div class="ttdoc">Stops the frame collector and joins worker threads.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00043">collector.cpp:43</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="afa8ed51e3c3dbcbb7395f8a78ecd0c4a" name="afa8ed51e3c3dbcbb7395f8a78ecd0c4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa8ed51e3c3dbcbb7395f8a78ecd0c4a">&#9670;&#160;</a></span>cleanUpSchedule()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::cleanUpSchedule </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> &gt;&#160;</td>
          <td class="paramname"><em>schedules</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes schedules from the schedule map. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">schedules</td><td>Vector of schedule times to clean up. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00342">342</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  343</span>{</div>
<div class="line"><span class="lineno">  344</span>  <span class="comment">// Erase all the schedules in the input vector</span></div>
<div class="line"><span class="lineno">  345</span>  <span class="keywordflow">for</span>(<span class="keyword">auto</span> <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a> : schedules) {</div>
<div class="line"><span class="lineno">  346</span>    <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.erase(<a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a>);</div>
<div class="line"><span class="lineno">  347</span>  }</div>
<div class="line"><span class="lineno">  348</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a65026725325000ef733111870bef4ea4"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">irsol::server::frame_collector::FrameCollector::m_scheduleMap</a></div><div class="ttdeci">std::map&lt; irsol::types::timepoint_t, std::vector&lt; irsol::types::client_id_t &gt; &gt; m_scheduleMap</div><div class="ttdoc">Maps timestamps to client IDs scheduled at that time.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00220">collector.hpp:220</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a9e2cbc309a05bf63f708e0df24134500"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">irsol::server::frame_collector::FrameCollector::schedule</a></div><div class="ttdeci">bool schedule(const irsol::types::client_id_t &amp;clientId, irsol::types::timepoint_t nextFrameDue)</div><div class="ttdoc">Schedules the next frame delivery for a client.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00384">collector.cpp:384</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a6230358201977df4fc63be18ed0719ac" name="a6230358201977df4fc63be18ed0719ac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6230358201977df4fc63be18ed0719ac">&#9670;&#160;</a></span>collectReadyClients()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> &gt;, std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> &gt; &gt; irsol::server::frame_collector::FrameCollector::collectReadyClients </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a>&#160;</td>
          <td class="paramname"><em>now</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a0ed53497239b16c18f07550a1473a445">irsol::types::duration_t</a>&#160;</td>
          <td class="paramname"><em>slack</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Collects clients who are scheduled to receive a frame at the given time. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">now</td><td>Current timestamp. </td></tr>
    <tr><td class="paramname">slack</td><td>Allowed slack between now and client's schedule for considering a client to be ready for receiving data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A pair of vectors: the first is a list of ready client IDs, the second contains the actual schedule times of the returned clients. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00314">314</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  316</span>{</div>
<div class="line"><span class="lineno">  317</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  318</span>    <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  319</span>    <span class="stringliteral">&quot;Collecting clients for time {}, with slack of {}&quot;</span>,</div>
<div class="line"><span class="lineno">  320</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(now),</div>
<div class="line"><span class="lineno">  321</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a>(slack));</div>
<div class="line"><span class="lineno">  322</span>  std::vector&lt;irsol::types::client_id_t&gt; readyClients;</div>
<div class="line"><span class="lineno">  323</span>  std::vector&lt;irsol::types::timepoint_t&gt; clientsSchedule;</div>
<div class="line"><span class="lineno">  324</span> </div>
<div class="line"><span class="lineno">  325</span>  <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; [scheduleTime, clients] : <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>) {</div>
<div class="line"><span class="lineno">  326</span>    <span class="comment">// As soon as the scheduleTime of the client is above now+slack, break the loop.</span></div>
<div class="line"><span class="lineno">  327</span>    <span class="comment">// We can break early, as m_scheduleMap is an ordered container, that is iterated over</span></div>
<div class="line"><span class="lineno">  328</span>    <span class="comment">// in a way that smaller keys (scheduledTimes) are always iterated over at the beginning.</span></div>
<div class="line"><span class="lineno">  329</span>    <span class="keywordflow">if</span>(scheduleTime &gt; now + slack) {</div>
<div class="line"><span class="lineno">  330</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  331</span>    }</div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; client : clients) {</div>
<div class="line"><span class="lineno">  333</span>      readyClients.push_back(client);</div>
<div class="line"><span class="lineno">  334</span>      clientsSchedule.push_back(scheduleTime);</div>
<div class="line"><span class="lineno">  335</span>    }</div>
<div class="line"><span class="lineno">  336</span>  }</div>
<div class="line"><span class="lineno">  337</span> </div>
<div class="line"><span class="lineno">  338</span>  <span class="keywordflow">return</span> {readyClients, clientsSchedule};</div>
<div class="line"><span class="lineno">  339</span>}</div>
<div class="ttc" id="agroup__Logging_html_ga57d5ed6ca38213a5cbb46950119a5f68"><div class="ttname"><a href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a></div><div class="ttdeci">#define IRSOL_NAMED_LOG_DEBUG(name,...)</div><div class="ttdoc">Logs a debug-level message using a named logger.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/da9/logging_8hpp_source.html#l00174">logging.hpp:174</a></div></div>
<div class="ttc" id="anamespaceirsol_1_1utils_html_aef8913b229de1370e4ba6c311adf9026"><div class="ttname"><a href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a></div><div class="ttdeci">std::string timestampToString(irsol::types::timepoint_t tp)</div><div class="ttdoc">Converts a steady_clock time point to a human-readable string.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d06/utils_8cpp_source.html#l00111">utils.cpp:111</a></div></div>
<div class="ttc" id="anamespaceirsol_1_1utils_html_af2468710608c92085f4771001ea3a105"><div class="ttname"><a href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a></div><div class="ttdeci">std::string durationToString(irsol::types::duration_t dr)</div><div class="ttdoc">Converts a duration to a human-readable string.</div><div class="ttdef"><b>Definition</b> <a href="../../de/d06/utils_8cpp_source.html#l00133">utils.cpp:133</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a270f12597aa6816da16db8acf71a3bf1" name="a270f12597aa6816da16db8acf71a3bf1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a270f12597aa6816da16db8acf71a3bf1">&#9670;&#160;</a></span>deregisterClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::deregisterClient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>&#160;</td>
          <td class="paramname"><em>clientId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Deregisters a client and stops frame delivery. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clientId</td><td>The client's unique identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Removes all state registered associated with the client in the collector. </dd>
<dd>
This method is thread-safe. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00106">106</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  107</span>{</div>
<div class="line"><span class="lineno">  108</span>  std::scoped_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aed68d05a46f603193623ac19015033b6">m_clientsMutex</a>);</div>
<div class="line"><span class="lineno">  109</span>  <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a3a8dab8e90db2c693d5ddd528a3c851c">deregisterClientNonThreadSafe</a>(clientId);</div>
<div class="line"><span class="lineno">  110</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a3a8dab8e90db2c693d5ddd528a3c851c"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a3a8dab8e90db2c693d5ddd528a3c851c">irsol::server::frame_collector::FrameCollector::deregisterClientNonThreadSafe</a></div><div class="ttdeci">void deregisterClientNonThreadSafe(irsol::types::client_id_t clientId)</div><div class="ttdoc">Deregisters a client and stops frame delivery (not thread-safe).</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00264">collector.cpp:264</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_aed68d05a46f603193623ac19015033b6"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aed68d05a46f603193623ac19015033b6">irsol::server::frame_collector::FrameCollector::m_clientsMutex</a></div><div class="ttdeci">std::mutex m_clientsMutex</div><div class="ttdoc">Protects access to m_clients and m_scheduleMap.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00216">collector.hpp:216</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a3a8dab8e90db2c693d5ddd528a3c851c" name="a3a8dab8e90db2c693d5ddd528a3c851c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3a8dab8e90db2c693d5ddd528a3c851c">&#9670;&#160;</a></span>deregisterClientNonThreadSafe()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::deregisterClientNonThreadSafe </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>&#160;</td>
          <td class="paramname"><em>clientId</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Deregisters a client and stops frame delivery (not thread-safe). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clientId</td><td>The client's unique identifier.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>Removes all state registered associated with the client in the collector. </dd>
<dd>
This method is NOT thread-safe and should only be called with appropriate locking. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00264">264</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  265</span>{</div>
<div class="line"><span class="lineno">  266</span>  <span class="comment">// Mark the client&#39;s queue as finished, so the client is notified that</span></div>
<div class="line"><span class="lineno">  267</span>  <span class="comment">// no more data will be pushed to him</span></div>
<div class="line"><span class="lineno">  268</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a>(<span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Deregistering client {}&quot;</span>, clientId);</div>
<div class="line"><span class="lineno">  269</span> </div>
<div class="line"><span class="lineno">  270</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.find(clientId) == <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.end()) {</div>
<div class="line"><span class="lineno">  271</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a>(</div>
<div class="line"><span class="lineno">  272</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Client {} was already deregistered, ignoring request.&quot;</span>, clientId);</div>
<div class="line"><span class="lineno">  273</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  274</span>  }</div>
<div class="line"><span class="lineno">  275</span>  <span class="keyword">auto</span>&amp; clientParams = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.at(clientId);</div>
<div class="line"><span class="lineno">  276</span>  clientParams.queue-&gt;producerFinished();</div>
<div class="line"><span class="lineno">  277</span> </div>
<div class="line"><span class="lineno">  278</span>  <span class="comment">// Removes the client from the storage</span></div>
<div class="line"><span class="lineno">  279</span>  <span class="keyword">auto</span> dueNext = clientParams.nextFrameDue;</div>
<div class="line"><span class="lineno">  280</span> </div>
<div class="line"><span class="lineno">  281</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.erase(clientId);</div>
<div class="line"><span class="lineno">  282</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  283</span>    <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Removed client {}, now remaining  {} clients&quot;</span>, clientId, <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.size());</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.find(dueNext) == <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.end()) {</div>
<div class="line"><span class="lineno">  286</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a>(</div>
<div class="line"><span class="lineno">  287</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  288</span>      <span class="stringliteral">&quot;Scheduled time {} was already deregistered. Ignoring request.&quot;</span>,</div>
<div class="line"><span class="lineno">  289</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(dueNext));</div>
<div class="line"><span class="lineno">  290</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  291</span>  }</div>
<div class="line"><span class="lineno">  292</span>  <span class="keyword">auto</span>&amp; clientsAtDue = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.at(dueNext);</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  295</span>    <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  296</span>    <span class="stringliteral">&quot;Deregistering client {} from next schedule at {}&quot;</span>,</div>
<div class="line"><span class="lineno">  297</span>    clientId,</div>
<div class="line"><span class="lineno">  298</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(dueNext));</div>
<div class="line"><span class="lineno">  299</span>  clientsAtDue.erase(</div>
<div class="line"><span class="lineno">  300</span>    std::remove(clientsAtDue.begin(), clientsAtDue.end(), clientId), clientsAtDue.end());</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>  <span class="keywordflow">if</span>(clientsAtDue.empty()) {</div>
<div class="line"><span class="lineno">  303</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  304</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  305</span>      <span class="stringliteral">&quot;No more clients for schedule {}. Removing schedule.&quot;</span>,</div>
<div class="line"><span class="lineno">  306</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(dueNext));</div>
<div class="line"><span class="lineno">  307</span>    <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.erase(dueNext);</div>
<div class="line"><span class="lineno">  308</span>  }</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a>.notify_one();</div>
<div class="line"><span class="lineno">  311</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a705254fa30d424a01adb204078c00b2d"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">irsol::server::frame_collector::FrameCollector::m_scheduleCondition</a></div><div class="ttdeci">std::condition_variable m_scheduleCondition</div><div class="ttdoc">Signals when a new client is scheduled.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00222">collector.hpp:222</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_aa625ad14ab3b7d73d535adc4339aead0"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">irsol::server::frame_collector::FrameCollector::m_clients</a></div><div class="ttdeci">std::unordered_map&lt; irsol::types::client_id_t, ClientCollectionParams &gt; m_clients</div><div class="ttdoc">Stores parameters for each registered client.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00218">collector.hpp:218</a></div></div>
<div class="ttc" id="agroup__Logging_html_ga30c2f8536dcd7ea3bb3a5bbc9f38a312"><div class="ttname"><a href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a></div><div class="ttdeci">#define IRSOL_NAMED_LOG_INFO(name,...)</div><div class="ttdoc">Logs an info-level message using a named logger.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/da9/logging_8hpp_source.html#l00176">logging.hpp:176</a></div></div>
<div class="ttc" id="agroup__Logging_html_gacab2ed396a15b61c949f1054a6a5aae4"><div class="ttname"><a href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a></div><div class="ttdeci">#define IRSOL_NAMED_LOG_WARN(name,...)</div><div class="ttdoc">Logs a warning-level message using a named logger.</div><div class="ttdef"><b>Definition</b> <a href="../../d0/da9/logging_8hpp_source.html#l00178">logging.hpp:178</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="adedefafaa21f9005668569913caaac0c" name="adedefafaa21f9005668569913caaac0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adedefafaa21f9005668569913caaac0c">&#9670;&#160;</a></span>grabImageData()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::optional&lt; std::pair&lt; <a class="el" href="../../da/d77/structirsol_1_1server_1_1frame__collector_1_1FrameMetadata.html">FrameMetadata</a>, std::vector&lt; <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#ae50d5e590e95d2c56f3ba94a4f07a1aa">irsol::types::byte_t</a> &gt; &gt; &gt; irsol::server::frame_collector::FrameCollector::grabImageData </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Captures an image and returns it along with associated metadata. </p>
<dl class="section return"><dt>Returns</dt><dd>A pair containing frame metadata and the image data buffer if image acquisition was successful, <code>std::nullopt</code> otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00351">351</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  352</span>{</div>
<div class="line"><span class="lineno">  353</span>  <span class="comment">// Capture the frame just-in-time</span></div>
<div class="line"><span class="lineno">  354</span>  <a class="code hl_define" href="../../db/dbe/macros_8hpp.html#ae833d90a9ab85f62810d95e34478a8ac">IRSOL_MAYBE_UNUSED</a> <span class="keyword">auto</span> t0    = irsol::types::clock_t::now();</div>
<div class="line"><span class="lineno">  355</span>  <span class="keyword">auto</span>                    image = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a89aff071a1e8bb9c5775575c6ec963b8">m_cam</a>.<a class="code hl_function" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html#a16f956ffd05322d402446ee425818fd4">captureImage</a>();</div>
<div class="line"><span class="lineno">  356</span>  <a class="code hl_define" href="../../db/dbe/macros_8hpp.html#ae833d90a9ab85f62810d95e34478a8ac">IRSOL_MAYBE_UNUSED</a> <span class="keyword">auto</span> t1    = irsol::types::clock_t::now();</div>
<div class="line"><span class="lineno">  357</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  358</span>    <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  359</span>    <span class="stringliteral">&quot;Capture image: start: {}, stop: {}, duration: {}&quot;</span>,</div>
<div class="line"><span class="lineno">  360</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(t0),</div>
<div class="line"><span class="lineno">  361</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(t1),</div>
<div class="line"><span class="lineno">  362</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a>(t1 - t0));</div>
<div class="line"><span class="lineno">  363</span> </div>
<div class="line"><span class="lineno">  364</span>  <span class="comment">// Extract the image data from the image buffer, and copy it into an</span></div>
<div class="line"><span class="lineno">  365</span>  <span class="comment">// owning structure. In this way, when `image` is destroyed at the end of the</span></div>
<div class="line"><span class="lineno">  366</span>  <span class="comment">// execution of this function, it can return into the pool of NeoAPI::Images</span></div>
<div class="line"><span class="lineno">  367</span>  <span class="comment">// for next frames to be written to the buffer.</span></div>
<div class="line"><span class="lineno">  368</span>  <span class="keyword">auto</span>* imageData = image.GetImageData();</div>
<div class="line"><span class="lineno">  369</span>  <span class="keyword">auto</span>  numBytes  = image.GetSize();</div>
<div class="line"><span class="lineno">  370</span> </div>
<div class="line"><span class="lineno">  371</span>  <span class="keywordflow">if</span>(numBytes == 0) {</div>
<div class="line"><span class="lineno">  372</span>    <span class="keywordflow">return</span> std::nullopt;</div>
<div class="line"><span class="lineno">  373</span>  }</div>
<div class="line"><span class="lineno">  374</span> </div>
<div class="line"><span class="lineno">  375</span>  std::vector&lt;irsol::types::byte_t&gt; rawData(numBytes);</div>
<div class="line"><span class="lineno">  376</span>  std::memcpy(rawData.data(), imageData, numBytes);</div>
<div class="line"><span class="lineno">  377</span> </div>
<div class="line"><span class="lineno">  378</span>  <span class="keywordflow">return</span> std::make_pair&lt;FrameMetadata, std::vector&lt;irsol::types::byte_t&gt;&gt;(</div>
<div class="line"><span class="lineno">  379</span>    {irsol::types::clock_t::now(), image.GetImageID(), image.GetHeight(), image.GetWidth()},</div>
<div class="line"><span class="lineno">  380</span>    std::move(rawData));</div>
<div class="line"><span class="lineno">  381</span>}</div>
<div class="ttc" id="aclassirsol_1_1camera_1_1Interface_html_a16f956ffd05322d402446ee425818fd4"><div class="ttname"><a href="../../d7/d37/classirsol_1_1camera_1_1Interface.html#a16f956ffd05322d402446ee425818fd4">irsol::camera::Interface::captureImage</a></div><div class="ttdeci">image_t captureImage(std::optional&lt; irsol::types::duration_t &gt; timeout=std::nullopt)</div><div class="ttdoc">Capture a single image from the camera.</div><div class="ttdef"><b>Definition</b> <a href="../../db/db7/interface_8cpp_source.html#l00232">interface.cpp:232</a></div></div>
<div class="ttc" id="amacros_8hpp_html_ae833d90a9ab85f62810d95e34478a8ac"><div class="ttname"><a href="../../db/dbe/macros_8hpp.html#ae833d90a9ab85f62810d95e34478a8ac">IRSOL_MAYBE_UNUSED</a></div><div class="ttdeci">#define IRSOL_MAYBE_UNUSED</div><div class="ttdoc">Suppresses compiler warnings about unused variables or parameters.</div><div class="ttdef"><b>Definition</b> <a href="../../db/dbe/macros_8hpp_source.html#l00039">macros.hpp:39</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aa1aad4f54c265bc5c2771ff9d79b6123" name="aa1aad4f54c265bc5c2771ff9d79b6123"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa1aad4f54c265bc5c2771ff9d79b6123">&#9670;&#160;</a></span>isBusy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool irsol::server::frame_collector::FrameCollector::isBusy </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Checks whether the collector is currently serving any clients. </p>
<dl class="section return"><dt>Returns</dt><dd>true if at least one client is registered, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00052">52</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   53</span>{</div>
<div class="line"><span class="lineno">   54</span>  <span class="keywordflow">return</span> !<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.empty();</div>
<div class="line"><span class="lineno">   55</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="af7b64373a4ab41a14089e39de5b40245" name="af7b64373a4ab41a14089e39de5b40245"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af7b64373a4ab41a14089e39de5b40245">&#9670;&#160;</a></span>makeQueuePtr()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::shared_ptr&lt; <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">FrameCollector::frame_queue_t</a> &gt; irsol::server::frame_collector::FrameCollector::makeQueuePtr </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Utility static function to create a shared pointer to a frame queue. </p>
<p>Clients may use this to obtain a queue prior to registering with the collector. </p><dl class="section return"><dt>Returns</dt><dd>Shared pointer to a new frame queue. </dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../dc/d49/classirsol_1_1utils_1_1SafeQueue.html" title="A thread-safe, optionally bounded queue with blocking push and pop operations.">irsol::utils::SafeQueue</a> </dd>
<dd>
<a class="el" href="../../dd/da2/classirsol_1_1server_1_1handlers_1_1CommandGIHandler.html" title="Handler for the gi command (single frame acquisition).">irsol::server::handlers::CommandGIHandler</a> </dd>
<dd>
<a class="el" href="../../dc/d49/classirsol_1_1server_1_1handlers_1_1CommandGISHandler.html" title="Handler for the gis command (sequence frame acquisition).">irsol::server::handlers::CommandGISHandler</a> </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00016">16</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   17</span>{</div>
<div class="line"><span class="lineno">   18</span>  <span class="keywordflow">return</span> std::make_shared&lt;FrameCollector::frame_queue_t&gt;();</div>
<div class="line"><span class="lineno">   19</span>}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a82c78c2d8c59c360184a852b5b53f101" name="a82c78c2d8c59c360184a852b5b53f101"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82c78c2d8c59c360184a852b5b53f101">&#9670;&#160;</a></span>registerClient()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::registerClient </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>&#160;</td>
          <td class="paramname"><em>clientId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double&#160;</td>
          <td class="paramname"><em>fps</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::shared_ptr&lt; <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8c8cef36ff52c80e1f28197618817491">frame_queue_t</a> &gt;&#160;</td>
          <td class="paramname"><em>queue</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&#160;</td>
          <td class="paramname"><em>frameCount</em> = <code>-1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Registers a client to receive frames at a specified frame rate. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clientId</td><td>Unique identifier for the client. </td></tr>
    <tr><td class="paramname">fps</td><td>Desired frame rate (frames per second). If fps &lt;= 0 and frameCount == 1, the client will receive a single frame immediately. Tipically used in <code>gi</code> command </td></tr>
  </table>
  </dd>
</dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../dd/da2/classirsol_1_1server_1_1handlers_1_1CommandGIHandler.html" title="Handler for the gi command (single frame acquisition).">irsol::server::handlers::CommandGIHandler</a>. </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">queue</td><td>Shared pointer to the client's frame queue. The collector will push frame data into this queue at the schedule defined by the client. </td></tr>
    <tr><td class="paramname">frameCount</td><td>Number of frames to deliver; -1 means unlimited. After the last frame has been pushed to the client, the client is automatically deregistered and its queue marked as complete. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This method is thread-safe. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00058">58</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   63</span>{</div>
<div class="line"><span class="lineno">   64</span> </div>
<div class="line"><span class="lineno">   65</span>  std::scoped_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aed68d05a46f603193623ac19015033b6">m_clientsMutex</a>);</div>
<div class="line"><span class="lineno">   66</span> </div>
<div class="line"><span class="lineno">   67</span>  std::chrono::microseconds interval;</div>
<div class="line"><span class="lineno">   68</span>  <span class="keywordtype">bool</span>                      immediate = <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">   69</span>  <span class="keywordflow">if</span>(frameCount == 1 &amp;&amp; fps &lt;= 0.0) {</div>
<div class="line"><span class="lineno">   70</span>    <span class="comment">// Client is requesting a single frame immediately</span></div>
<div class="line"><span class="lineno">   71</span>    interval   = std::chrono::microseconds(1);</div>
<div class="line"><span class="lineno">   72</span>    immediate  = <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">   73</span>    frameCount = 1;</div>
<div class="line"><span class="lineno">   74</span>    fps        = 0.0;</div>
<div class="line"><span class="lineno">   75</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   76</span>    interval = std::chrono::microseconds(<span class="keyword">static_cast&lt;</span>uint64_t<span class="keyword">&gt;</span>(1000000.0 / fps));</div>
<div class="line"><span class="lineno">   77</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a>(</div>
<div class="line"><span class="lineno">   78</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">   79</span>      <span class="stringliteral">&quot;registering client with interval of {}&quot;</span>,</div>
<div class="line"><span class="lineno">   80</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a>(interval));</div>
<div class="line"><span class="lineno">   81</span>  }</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>  <span class="comment">// Registers the client so that the next due time is in SLACK ms.</span></div>
<div class="line"><span class="lineno">   84</span>  <span class="comment">// This is to allow the collector thread to batch multiple clients, that desire a frame at a</span></div>
<div class="line"><span class="lineno">   85</span>  <span class="comment">// specific timestamp, but all within the SLACK duration and to serve them all with the same frame</span></div>
<div class="line"><span class="lineno">   86</span>  <span class="comment">// image.</span></div>
<div class="line"><span class="lineno">   87</span>  <span class="keyword">auto</span> nextDue = irsol::types::clock_t::now() + <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ad7ab4acc72d3fad2bf71f6aa79b47a97">FrameCollector::SLACK</a>;</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>  <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a>(</div>
<div class="line"><span class="lineno">   90</span>    <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">   91</span>    <span class="stringliteral">&quot;Registering client {} with frame rate {} fps (interval {}), &quot;</span></div>
<div class="line"><span class="lineno">   92</span>    <span class="stringliteral">&quot;next frame due at {} #frames {}, immediate {}&quot;</span>,</div>
<div class="line"><span class="lineno">   93</span>    clientId,</div>
<div class="line"><span class="lineno">   94</span>    fps,</div>
<div class="line"><span class="lineno">   95</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a>(interval),</div>
<div class="line"><span class="lineno">   96</span>    <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(nextDue),</div>
<div class="line"><span class="lineno">   97</span>    frameCount,</div>
<div class="line"><span class="lineno">   98</span>    immediate);</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.emplace(</div>
<div class="line"><span class="lineno">  101</span>    clientId, ClientCollectionParams(fps, interval, nextDue, queue, frameCount, immediate));</div>
<div class="line"><span class="lineno">  102</span>  <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a>(clientId, nextDue);</div>
<div class="line"><span class="lineno">  103</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_ad7ab4acc72d3fad2bf71f6aa79b47a97"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ad7ab4acc72d3fad2bf71f6aa79b47a97">irsol::server::frame_collector::FrameCollector::SLACK</a></div><div class="ttdeci">static constexpr irsol::types::duration_t SLACK</div><div class="ttdoc">Slack window for batching frame delivery to clients.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00091">collector.hpp:91</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a128380895ffbc5b1d34db2dcdd5cecb0" name="a128380895ffbc5b1d34db2dcdd5cecb0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a128380895ffbc5b1d34db2dcdd5cecb0">&#9670;&#160;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::run </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Runs the frame distribution loop in a background thread. </p>
<p>This method monitors client schedules, captures frames as needed, and distributes them to all clients whose scheduled delivery times fall within the current slack window. It also handles automatic deregistration of clients who have received their requested number of frames. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00113">113</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  114</span>{</div>
<div class="line"><span class="lineno">  115</span>  std::unique_lock&lt;std::mutex&gt; lock(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aed68d05a46f603193623ac19015033b6">m_clientsMutex</a>);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>  <span class="keywordflow">while</span>(!<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>) {</div>
<div class="line"><span class="lineno">  118</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.empty()) {</div>
<div class="line"><span class="lineno">  119</span>      <span class="comment">// Wait until at least one new client is registered in the map, or if a stop request has</span></div>
<div class="line"><span class="lineno">  120</span>      <span class="comment">// arrived.</span></div>
<div class="line"><span class="lineno">  121</span>      <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a>.wait(lock, [<span class="keyword">this</span>]() {</div>
<div class="line"><span class="lineno">  122</span>        <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  123</span>          <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  124</span>          <span class="stringliteral">&quot;Waiting until a client is scheduled (clients size: {}, schedule size: {})&quot;</span>,</div>
<div class="line"><span class="lineno">  125</span>          <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.size(),</div>
<div class="line"><span class="lineno">  126</span>          <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.size());</div>
<div class="line"><span class="lineno">  127</span>        <span class="keywordflow">return</span> <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a> || !<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.empty();</div>
<div class="line"><span class="lineno">  128</span>      });</div>
<div class="line"><span class="lineno">  129</span>    }</div>
<div class="line"><span class="lineno">  130</span> </div>
<div class="line"><span class="lineno">  131</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>.load()) {</div>
<div class="line"><span class="lineno">  132</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a>(<span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Requested frame-collection stop&quot;</span>);</div>
<div class="line"><span class="lineno">  133</span>      <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  134</span>    }</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>    <span class="comment">// Retrieve the nextDue time from the schedule map.</span></div>
<div class="line"><span class="lineno">  137</span>    <span class="comment">// This map is always sorted from small to high, as it&#39;s an ordered container.</span></div>
<div class="line"><span class="lineno">  138</span>    <a class="code hl_typedef" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> nextDue = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.begin()-&gt;first;</div>
<div class="line"><span class="lineno">  139</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  140</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  141</span>      <span class="stringliteral">&quot;Running for frame collection due at {}&quot;</span>,</div>
<div class="line"><span class="lineno">  142</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(nextDue));</div>
<div class="line"><span class="lineno">  143</span> </div>
<div class="line"><span class="lineno">  144</span>    <span class="comment">// Wait at most until the `nextDue` time.</span></div>
<div class="line"><span class="lineno">  145</span>    <span class="comment">// Allow for early break in case of:</span></div>
<div class="line"><span class="lineno">  146</span>    <span class="comment">// - m_stop is set to true due to a stop-request</span></div>
<div class="line"><span class="lineno">  147</span>    <span class="comment">// - a new client is registered with a nextDue time that is smaller than the current nextDue</span></div>
<div class="line"><span class="lineno">  148</span>    <span class="comment">// time</span></div>
<div class="line"><span class="lineno">  149</span>    <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a>.wait_until(lock, nextDue, [<span class="keyword">this</span>, currentNextDue = nextDue]() {</div>
<div class="line"><span class="lineno">  150</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>.load()) {</div>
<div class="line"><span class="lineno">  151</span>        <span class="comment">// stopped externally, exit the wait</span></div>
<div class="line"><span class="lineno">  152</span>        return true;</div>
<div class="line"><span class="lineno">  153</span>      }</div>
<div class="line"><span class="lineno">  154</span>      <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.empty()) {</div>
<div class="line"><span class="lineno">  155</span>        <span class="comment">// Don&#39;t wake up early unnecessarily, as there&#39;s no schedules in the map</span></div>
<div class="line"><span class="lineno">  156</span>        return false;</div>
<div class="line"><span class="lineno">  157</span>      }</div>
<div class="line"><span class="lineno">  158</span> </div>
<div class="line"><span class="lineno">  159</span>      <span class="comment">// Check if a new schedule has been inserted into the map, which happens</span></div>
<div class="line"><span class="lineno">  160</span>      <span class="comment">// earlier than the due time we captured prior to sleeping.</span></div>
<div class="line"><span class="lineno">  161</span>      <span class="keyword">auto</span> newNextDue = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.begin()-&gt;first;</div>
<div class="line"><span class="lineno">  162</span> </div>
<div class="line"><span class="lineno">  163</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  164</span>        <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  165</span>        <span class="stringliteral">&quot;Current first timestamp in the map: {}, current nextDue: {}&quot;</span>,</div>
<div class="line"><span class="lineno">  166</span>        <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(newNextDue),</div>
<div class="line"><span class="lineno">  167</span>        <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(currentNextDue));</div>
<div class="line"><span class="lineno">  168</span>      <span class="keywordflow">return</span> newNextDue &lt; currentNextDue;</div>
<div class="line"><span class="lineno">  169</span>    });</div>
<div class="line"><span class="lineno">  170</span> </div>
<div class="line"><span class="lineno">  171</span>    <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>.load()) {</div>
<div class="line"><span class="lineno">  172</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga30c2f8536dcd7ea3bb3a5bbc9f38a312">IRSOL_NAMED_LOG_INFO</a>(</div>
<div class="line"><span class="lineno">  173</span>        <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Frame collection stop request received, breaking loop&quot;</span>);</div>
<div class="line"><span class="lineno">  174</span>      <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  175</span>    }</div>
<div class="line"><span class="lineno">  176</span> </div>
<div class="line"><span class="lineno">  177</span>    <span class="comment">// Refresh the nextDue, as the above condition might have finished due to a new client being</span></div>
<div class="line"><span class="lineno">  178</span>    <span class="comment">// registered earlier than the &#39;nextDue&#39; time that was initially selected.</span></div>
<div class="line"><span class="lineno">  179</span>    nextDue = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.begin()-&gt;first;</div>
<div class="line"><span class="lineno">  180</span> </div>
<div class="line"><span class="lineno">  181</span>    <span class="comment">// Clients due now or earlier</span></div>
<div class="line"><span class="lineno">  182</span>    <a class="code hl_typedef" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a> now = irsol::types::clock_t::now();</div>
<div class="line"><span class="lineno">  183</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  184</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  185</span>      <span class="stringliteral">&quot;Woken up at timestamp {}, with next due at {}&quot;</span>,</div>
<div class="line"><span class="lineno">  186</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(now),</div>
<div class="line"><span class="lineno">  187</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(nextDue));</div>
<div class="line"><span class="lineno">  188</span> </div>
<div class="line"><span class="lineno">  189</span>    <span class="keyword">const</span> <span class="keyword">auto</span> slack = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.size() == 1 ? std::chrono::milliseconds(0) : <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8be6ebec2ed0d3f0a78b001c810c4108">FrameCollector</a>::<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ad7ab4acc72d3fad2bf71f6aa79b47a97">SLACK</a>;</div>
<div class="line"><span class="lineno">  190</span>    <span class="keyword">auto</span> [readyClients, clientsSchedules] = <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a6230358201977df4fc63be18ed0719ac">collectReadyClients</a>(now, slack);</div>
<div class="line"><span class="lineno">  191</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  192</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Found {} clients that need an image now!&quot;</span>, readyClients.size());</div>
<div class="line"><span class="lineno">  193</span>    {</div>
<div class="line"><span class="lineno">  194</span>      <span class="keyword">auto</span> uniqueSchedules =</div>
<div class="line"><span class="lineno">  195</span>        std::set&lt;irsol::types::timepoint_t&gt;(clientsSchedules.begin(), clientsSchedules.end());</div>
<div class="line"><span class="lineno">  196</span>      <span class="keywordflow">for</span>(<span class="keyword">auto</span> uniqueSchedule : uniqueSchedules) {</div>
<div class="line"><span class="lineno">  197</span>        <span class="keyword">auto</span> numClientsWithSchedule = std::count_if(</div>
<div class="line"><span class="lineno">  198</span>          clientsSchedules.begin(),</div>
<div class="line"><span class="lineno">  199</span>          clientsSchedules.end(),</div>
<div class="line"><span class="lineno">  200</span>          [&amp;uniqueSchedule](<span class="keyword">const</span> <span class="keyword">auto</span>&amp; <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a>) { return schedule == uniqueSchedule; });</div>
<div class="line"><span class="lineno">  201</span> </div>
<div class="line"><span class="lineno">  202</span>        <span class="keywordflow">if</span>(uniqueSchedule != nextDue) {</div>
<div class="line"><span class="lineno">  203</span>          <a class="code hl_define" href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a>(</div>
<div class="line"><span class="lineno">  204</span>            <span class="stringliteral">&quot;frame_collector_slack&quot;</span>,</div>
<div class="line"><span class="lineno">  205</span>            <span class="stringliteral">&quot;Actual schedule: {}, also considering {} clients with schedule {} due to allowed &quot;</span></div>
<div class="line"><span class="lineno">  206</span>            <span class="stringliteral">&quot;slack of {}&quot;</span>,</div>
<div class="line"><span class="lineno">  207</span>            <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(nextDue),</div>
<div class="line"><span class="lineno">  208</span>            numClientsWithSchedule,</div>
<div class="line"><span class="lineno">  209</span>            <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(uniqueSchedule),</div>
<div class="line"><span class="lineno">  210</span>            <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#af2468710608c92085f4771001ea3a105">irsol::utils::durationToString</a>(slack));</div>
<div class="line"><span class="lineno">  211</span>        }</div>
<div class="line"><span class="lineno">  212</span>      }</div>
<div class="line"><span class="lineno">  213</span>    }</div>
<div class="line"><span class="lineno">  214</span>    <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#afa8ed51e3c3dbcbb7395f8a78ecd0c4a">cleanUpSchedule</a>(clientsSchedules);</div>
<div class="line"><span class="lineno">  215</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  216</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  217</span>      <span class="stringliteral">&quot;After schedule cleanup, there are still {} schedules&quot;</span>,</div>
<div class="line"><span class="lineno">  218</span>      <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>.size());</div>
<div class="line"><span class="lineno">  219</span> </div>
<div class="line"><span class="lineno">  220</span>    <span class="keyword">auto</span> grabResult = <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#adedefafaa21f9005668569913caaac0c">grabImageData</a>();</div>
<div class="line"><span class="lineno">  221</span>    <span class="keywordflow">if</span>(!grabResult) {</div>
<div class="line"><span class="lineno">  222</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a>(<span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Image acquisition failed.&quot;</span>);</div>
<div class="line"><span class="lineno">  223</span>      <span class="keywordflow">continue</span>;</div>
<div class="line"><span class="lineno">  224</span>    }</div>
<div class="line"><span class="lineno">  225</span>    <span class="keyword">auto</span>&amp; [frameMetadata, imageRawBuffer] = *grabResult;</div>
<div class="line"><span class="lineno">  226</span> </div>
<div class="line"><span class="lineno">  227</span>    <span class="comment">// Deliver the frame to clients</span></div>
<div class="line"><span class="lineno">  228</span>    std::vector&lt;irsol::types::client_id_t&gt; finishedClient;</div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">for</span>(<span class="keyword">auto</span> clientId : readyClients) {</div>
<div class="line"><span class="lineno">  230</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(<span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Notifying client {} for new image data&quot;</span>, clientId);</div>
<div class="line"><span class="lineno">  231</span>      <span class="keyword">auto</span>&amp; clientParams = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.at(clientId);</div>
<div class="line"><span class="lineno">  232</span>      <span class="comment">// Push a new frame created on the fly to the current client&#39;s queue.</span></div>
<div class="line"><span class="lineno">  233</span>      <span class="comment">// This creates a copy of the image data into the queue, and this is wanted, so that if a</span></div>
<div class="line"><span class="lineno">  234</span>      <span class="comment">// consumer modifies the image, it doesn&#39;t affect other clients.</span></div>
<div class="line"><span class="lineno">  235</span>      clientParams.queue-&gt;push(std::make_unique&lt;Frame&gt;(</div>
<div class="line"><span class="lineno">  236</span>        frameMetadata,</div>
<div class="line"><span class="lineno">  237</span>        <a class="code hl_struct" href="../../dd/d6d/structirsol_1_1protocol_1_1internal_1_1BinaryData.html">irsol::protocol::ImageBinaryData</a>(</div>
<div class="line"><span class="lineno">  238</span>          {imageRawBuffer.begin(), imageRawBuffer.end()},</div>
<div class="line"><span class="lineno">  239</span>          {frameMetadata.height, frameMetadata.width},</div>
<div class="line"><span class="lineno">  240</span>          {<a class="code hl_struct" href="../../d4/d7a/structirsol_1_1protocol_1_1BinaryDataAttribute.html">irsol::protocol::BinaryDataAttribute</a>(<span class="stringliteral">&quot;imageId&quot;</span>, <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(frameMetadata.frameId)),</div>
<div class="line"><span class="lineno">  241</span>           <a class="code hl_struct" href="../../d4/d7a/structirsol_1_1protocol_1_1BinaryDataAttribute.html">irsol::protocol::BinaryDataAttribute</a>(</div>
<div class="line"><span class="lineno">  242</span>             <span class="stringliteral">&quot;timestamp&quot;</span>, <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(frameMetadata.timestamp))})));</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>      <span class="comment">// Try to schedule the client, if no longer needed, register it in the finishedClients</span></div>
<div class="line"><span class="lineno">  245</span>      <span class="keywordflow">if</span>(!<a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a9e2cbc309a05bf63f708e0df24134500">schedule</a>(clientId, clientParams.nextFrameDue + clientParams.interval)) {</div>
<div class="line"><span class="lineno">  246</span>        finishedClient.push_back(clientId);</div>
<div class="line"><span class="lineno">  247</span>      }</div>
<div class="line"><span class="lineno">  248</span>    }</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    <span class="comment">// Unlock the clients so we can remove finished clients</span></div>
<div class="line"><span class="lineno">  251</span>    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; clientId : finishedClient) {</div>
<div class="line"><span class="lineno">  252</span>      <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  253</span>        <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  254</span>        <span class="stringliteral">&quot;Deregistering client {}, as it has consumed all the frames it needed.&quot;</span>,</div>
<div class="line"><span class="lineno">  255</span>        clientId);</div>
<div class="line"><span class="lineno">  256</span>      <a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a3a8dab8e90db2c693d5ddd528a3c851c">deregisterClientNonThreadSafe</a>(clientId);</div>
<div class="line"><span class="lineno">  257</span>    }</div>
<div class="line"><span class="lineno">  258</span> </div>
<div class="line"><span class="lineno">  259</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(<span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Loop finished, restarting loop&quot;</span>);</div>
<div class="line"><span class="lineno">  260</span>  }</div>
<div class="line"><span class="lineno">  261</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a01788beed29fbd39b3c7c6fd799dea1c"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">irsol::server::frame_collector::FrameCollector::m_stop</a></div><div class="ttdeci">std::atomic&lt; bool &gt; m_stop</div><div class="ttdoc">Indicates whether the collector is stopping due to an external request.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00225">collector.hpp:225</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a6230358201977df4fc63be18ed0719ac"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a6230358201977df4fc63be18ed0719ac">irsol::server::frame_collector::FrameCollector::collectReadyClients</a></div><div class="ttdeci">std::pair&lt; std::vector&lt; irsol::types::client_id_t &gt;, std::vector&lt; irsol::types::timepoint_t &gt; &gt; collectReadyClients(irsol::types::timepoint_t now, irsol::types::duration_t slack) const</div><div class="ttdoc">Collects clients who are scheduled to receive a frame at the given time.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00314">collector.cpp:314</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a8be6ebec2ed0d3f0a78b001c810c4108"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a8be6ebec2ed0d3f0a78b001c810c4108">irsol::server::frame_collector::FrameCollector::FrameCollector</a></div><div class="ttdeci">FrameCollector(irsol::camera::Interface &amp;camera)</div><div class="ttdoc">Constructs a FrameCollector for the given camera interface.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00021">collector.cpp:21</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_adedefafaa21f9005668569913caaac0c"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#adedefafaa21f9005668569913caaac0c">irsol::server::frame_collector::FrameCollector::grabImageData</a></div><div class="ttdeci">std::optional&lt; std::pair&lt; FrameMetadata, std::vector&lt; irsol::types::byte_t &gt; &gt; &gt; grabImageData() const</div><div class="ttdoc">Captures an image and returns it along with associated metadata.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00351">collector.cpp:351</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_afa8ed51e3c3dbcbb7395f8a78ecd0c4a"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#afa8ed51e3c3dbcbb7395f8a78ecd0c4a">irsol::server::frame_collector::FrameCollector::cleanUpSchedule</a></div><div class="ttdeci">void cleanUpSchedule(const std::vector&lt; irsol::types::timepoint_t &gt; schedules)</div><div class="ttdoc">Removes schedules from the schedule map.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00342">collector.cpp:342</a></div></div>
<div class="ttc" id="anamespaceirsol_1_1types_html_afa4fbacf381780b62e4164ce9cdab22c"><div class="ttname"><a href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a></div><div class="ttdeci">clock_t::time_point timepoint_t</div><div class="ttdoc">Alias for a point in time as defined by clock_t.</div><div class="ttdef"><b>Definition</b> <a href="../../dd/de3/types_8hpp_source.html#l00120">types.hpp:120</a></div></div>
<div class="ttc" id="astructirsol_1_1protocol_1_1BinaryDataAttribute_html"><div class="ttname"><a href="../../d4/d7a/structirsol_1_1protocol_1_1BinaryDataAttribute.html">irsol::protocol::BinaryDataAttribute</a></div><div class="ttdoc">Represents a single binary data attribute within the protocol.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d2e/binary_8hpp_source.html#l00034">binary.hpp:35</a></div></div>
<div class="ttc" id="astructirsol_1_1protocol_1_1internal_1_1BinaryData_html"><div class="ttname"><a href="../../dd/d6d/structirsol_1_1protocol_1_1internal_1_1BinaryData.html">irsol::protocol::internal::BinaryData</a></div><div class="ttdoc">Represents a binary data object within the protocol.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d2e/binary_8hpp_source.html#l00106">binary.hpp:107</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a9e2cbc309a05bf63f708e0df24134500" name="a9e2cbc309a05bf63f708e0df24134500"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9e2cbc309a05bf63f708e0df24134500">&#9670;&#160;</a></span>schedule()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool irsol::server::frame_collector::FrameCollector::schedule </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a> &amp;&#160;</td>
          <td class="paramname"><em>clientId</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a>&#160;</td>
          <td class="paramname"><em>nextFrameDue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Schedules the next frame delivery for a client. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">clientId</td><td>The client to schedule. </td></tr>
    <tr><td class="paramname">nextFrameDue</td><td>The next timestamp when the client should receive a frame. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if successfully scheduled, false if the client is no longer active and can later be removed from the frame collector. </dd></dl>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00384">384</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  387</span>{</div>
<div class="line"><span class="lineno">  388</span>  <a class="code hl_define" href="../../d0/df0/group__Assertion.html#gae503472051c488fb16db93a66e9bbb23">IRSOL_ASSERT_ERROR</a>(</div>
<div class="line"><span class="lineno">  389</span>    <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.find(clientId) != <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.end(), <span class="stringliteral">&quot;Impossible to schedule an unregistered client.&quot;</span>);</div>
<div class="line"><span class="lineno">  390</span>  <span class="comment">// Update the parameters of the client.</span></div>
<div class="line"><span class="lineno">  391</span>  <span class="keyword">auto</span>&amp; clientParams = <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#aa625ad14ab3b7d73d535adc4339aead0">m_clients</a>.at(clientId);</div>
<div class="line"><span class="lineno">  392</span>  <span class="keywordflow">if</span>(clientParams.remainingFrames-- == 0 &amp;&amp; clientParams.remainingFrames &lt; 0) {</div>
<div class="line"><span class="lineno">  393</span>    <span class="comment">// Client no longer expects frames.</span></div>
<div class="line"><span class="lineno">  394</span>    <span class="comment">// This handles also clients that are listening forever, as their &#39;remainingFrames&#39; is negative</span></div>
<div class="line"><span class="lineno">  395</span>    <span class="comment">// so this condition is never fully met.</span></div>
<div class="line"><span class="lineno">  396</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  397</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Client {} had no longer frames to produce.&quot;</span>, clientId);</div>
<div class="line"><span class="lineno">  398</span>    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><span class="lineno">  399</span>  }</div>
<div class="line"><span class="lineno">  400</span> </div>
<div class="line"><span class="lineno">  401</span>  <span class="keywordflow">if</span>(clientParams.nextFrameDue == nextFrameDue) {</div>
<div class="line"><span class="lineno">  402</span>    <span class="comment">// This has been called the first time for client-registration</span></div>
<div class="line"><span class="lineno">  403</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  404</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  405</span>      <span class="stringliteral">&quot;Client {} has been scheduled for timestamp {}.&quot;</span>,</div>
<div class="line"><span class="lineno">  406</span>      clientId,</div>
<div class="line"><span class="lineno">  407</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(clientParams.nextFrameDue));</div>
<div class="line"><span class="lineno">  408</span>  } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  409</span> </div>
<div class="line"><span class="lineno">  410</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#ga57d5ed6ca38213a5cbb46950119a5f68">IRSOL_NAMED_LOG_DEBUG</a>(</div>
<div class="line"><span class="lineno">  411</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>,</div>
<div class="line"><span class="lineno">  412</span>      <span class="stringliteral">&quot;(Rescheduling client {} for next frame, previous due: {}, next due {}, # count {}&quot;</span>,</div>
<div class="line"><span class="lineno">  413</span>      clientId,</div>
<div class="line"><span class="lineno">  414</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(clientParams.nextFrameDue),</div>
<div class="line"><span class="lineno">  415</span>      <a class="code hl_function" href="../../d8/d93/namespaceirsol_1_1utils.html#aef8913b229de1370e4ba6c311adf9026">irsol::utils::timestampToString</a>(nextFrameDue),</div>
<div class="line"><span class="lineno">  416</span>      clientParams.remainingFrames);</div>
<div class="line"><span class="lineno">  417</span>  }</div>
<div class="line"><span class="lineno">  418</span> </div>
<div class="line"><span class="lineno">  419</span>  <span class="comment">// Updates the parameters of the client</span></div>
<div class="line"><span class="lineno">  420</span>  clientParams.nextFrameDue = nextFrameDue;</div>
<div class="line"><span class="lineno">  421</span> </div>
<div class="line"><span class="lineno">  422</span>  <span class="comment">// Registers the client for the scheduled timestamp.</span></div>
<div class="line"><span class="lineno">  423</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a65026725325000ef733111870bef4ea4">m_scheduleMap</a>[nextFrameDue].push_back(clientId);</div>
<div class="line"><span class="lineno">  424</span> </div>
<div class="line"><span class="lineno">  425</span>  <span class="comment">// Notify the condition variable, that a new client has been scheduled</span></div>
<div class="line"><span class="lineno">  426</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a>.notify_one();</div>
<div class="line"><span class="lineno">  427</span>  <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><span class="lineno">  428</span>}</div>
<div class="ttc" id="agroup__Assertion_html_gae503472051c488fb16db93a66e9bbb23"><div class="ttname"><a href="../../d0/df0/group__Assertion.html#gae503472051c488fb16db93a66e9bbb23">IRSOL_ASSERT_ERROR</a></div><div class="ttdeci">#define IRSOL_ASSERT_ERROR</div><div class="ttdoc">Error-level assertion macro.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d54/assert_8hpp_source.html#l00134">assert.hpp:134</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a2eda10c577b209e3635abd108b69318d" name="a2eda10c577b209e3635abd108b69318d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2eda10c577b209e3635abd108b69318d">&#9670;&#160;</a></span>start()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::start </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts the frame collection and distribution thread. </p>
<p>If the collector is already running, this call is ignored. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00032">32</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span>{</div>
<div class="line"><span class="lineno">   34</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>.load()) {</div>
<div class="line"><span class="lineno">   35</span>    <a class="code hl_define" href="../../d0/d58/group__Logging.html#gacab2ed396a15b61c949f1054a6a5aae4">IRSOL_NAMED_LOG_WARN</a>(</div>
<div class="line"><span class="lineno">   36</span>      <span class="stringliteral">&quot;frame_collector&quot;</span>, <span class="stringliteral">&quot;Collector was requested to stop already. Ignoring re-start request&quot;</span>);</div>
<div class="line"><span class="lineno">   37</span>    <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">   38</span>  }</div>
<div class="line"><span class="lineno">   39</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a4b75eeab69b857b5a55261117b733205">m_distributorThread</a> = std::thread(&amp;<a class="code hl_function" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a128380895ffbc5b1d34db2dcdd5cecb0">FrameCollector::run</a>, <span class="keyword">this</span>);</div>
<div class="line"><span class="lineno">   40</span>}</div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a128380895ffbc5b1d34db2dcdd5cecb0"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a128380895ffbc5b1d34db2dcdd5cecb0">irsol::server::frame_collector::FrameCollector::run</a></div><div class="ttdeci">void run()</div><div class="ttdoc">Runs the frame distribution loop in a background thread.</div><div class="ttdef"><b>Definition</b> <a href="../../db/d61/collector_8cpp_source.html#l00113">collector.cpp:113</a></div></div>
<div class="ttc" id="aclassirsol_1_1server_1_1frame__collector_1_1FrameCollector_html_a4b75eeab69b857b5a55261117b733205"><div class="ttname"><a href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a4b75eeab69b857b5a55261117b733205">irsol::server::frame_collector::FrameCollector::m_distributorThread</a></div><div class="ttdeci">std::thread m_distributorThread</div><div class="ttdoc">Thread responsible for frame distribution.</div><div class="ttdef"><b>Definition</b> <a href="../../d4/d4b/collector_8hpp_source.html#l00223">collector.hpp:223</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ae06173b3a37b853384004250cbdc2a16" name="ae06173b3a37b853384004250cbdc2a16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae06173b3a37b853384004250cbdc2a16">&#9670;&#160;</a></span>stop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void irsol::server::frame_collector::FrameCollector::stop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops the frame collector and joins worker threads. </p>
<p>After calling <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#ae06173b3a37b853384004250cbdc2a16" title="Stops the frame collector and joins worker threads.">stop()</a>, no further frames will be delivered to clients. </p>

<p class="definition">Definition at line <a class="el" href="../../db/d61/collector_8cpp_source.html#l00043">43</a> of file <a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   44</span>{</div>
<div class="line"><span class="lineno">   45</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a01788beed29fbd39b3c7c6fd799dea1c">m_stop</a>.store(<span class="keyword">true</span>);</div>
<div class="line"><span class="lineno">   46</span>  <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a705254fa30d424a01adb204078c00b2d">m_scheduleCondition</a>.notify_all();</div>
<div class="line"><span class="lineno">   47</span>  <span class="keywordflow">if</span>(<a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a4b75eeab69b857b5a55261117b733205">m_distributorThread</a>.joinable())</div>
<div class="line"><span class="lineno">   48</span>    <a class="code hl_variable" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html#a4b75eeab69b857b5a55261117b733205">m_distributorThread</a>.join();</div>
<div class="line"><span class="lineno">   49</span>}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a89aff071a1e8bb9c5775575c6ec963b8" name="a89aff071a1e8bb9c5775575c6ec963b8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a89aff071a1e8bb9c5775575c6ec963b8">&#9670;&#160;</a></span>m_cam</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html">irsol::camera::Interface</a>&amp; irsol::server::frame_collector::FrameCollector::m_cam</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the camera interface used for capturing. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00214">214</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="aa625ad14ab3b7d73d535adc4339aead0" name="aa625ad14ab3b7d73d535adc4339aead0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa625ad14ab3b7d73d535adc4339aead0">&#9670;&#160;</a></span>m_clients</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::unordered_map&lt;<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>, <a class="el" href="../../d5/d11/structirsol_1_1server_1_1frame__collector_1_1ClientCollectionParams.html">ClientCollectionParams</a>&gt; irsol::server::frame_collector::FrameCollector::m_clients</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores parameters for each registered client. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00218">218</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="aed68d05a46f603193623ac19015033b6" name="aed68d05a46f603193623ac19015033b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed68d05a46f603193623ac19015033b6">&#9670;&#160;</a></span>m_clientsMutex</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::mutex irsol::server::frame_collector::FrameCollector::m_clientsMutex</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Protects access to m_clients and m_scheduleMap. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00216">216</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="a4b75eeab69b857b5a55261117b733205" name="a4b75eeab69b857b5a55261117b733205"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b75eeab69b857b5a55261117b733205">&#9670;&#160;</a></span>m_distributorThread</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::thread irsol::server::frame_collector::FrameCollector::m_distributorThread</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Thread responsible for frame distribution. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00223">223</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="a705254fa30d424a01adb204078c00b2d" name="a705254fa30d424a01adb204078c00b2d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a705254fa30d424a01adb204078c00b2d">&#9670;&#160;</a></span>m_scheduleCondition</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::condition_variable irsol::server::frame_collector::FrameCollector::m_scheduleCondition</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Signals when a new client is scheduled. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00222">222</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="a65026725325000ef733111870bef4ea4" name="a65026725325000ef733111870bef4ea4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a65026725325000ef733111870bef4ea4">&#9670;&#160;</a></span>m_scheduleMap</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::map&lt;<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#afa4fbacf381780b62e4164ce9cdab22c">irsol::types::timepoint_t</a>, std::vector&lt;<a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a1e34241919e241ec2f3f6b8c236f40ae">irsol::types::client_id_t</a>&gt; &gt; irsol::server::frame_collector::FrameCollector::m_scheduleMap</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Maps timestamps to client IDs scheduled at that time. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00220">220</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<a id="a01788beed29fbd39b3c7c6fd799dea1c" name="a01788beed29fbd39b3c7c6fd799dea1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a01788beed29fbd39b3c7c6fd799dea1c">&#9670;&#160;</a></span>m_stop</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::atomic&lt;bool&gt; irsol::server::frame_collector::FrameCollector::m_stop</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">false</span>}</div>
</div><!-- fragment -->
<p>Indicates whether the collector is stopping due to an external request. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00225">225</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  225</span>                        {</div>
<div class="line"><span class="lineno">  226</span>    <span class="keyword">false</span>};  </div>
</div><!-- fragment -->
</div>
</div>
<a id="ad7ab4acc72d3fad2bf71f6aa79b47a97" name="ad7ab4acc72d3fad2bf71f6aa79b47a97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7ab4acc72d3fad2bf71f6aa79b47a97">&#9670;&#160;</a></span>SLACK</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">constexpr <a class="el" href="../../d9/d2e/namespaceirsol_1_1types.html#a0ed53497239b16c18f07550a1473a445">irsol::types::duration_t</a> irsol::server::frame_collector::FrameCollector::SLACK = std::chrono::milliseconds(50)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span><span class="mlabel">constexpr</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Slack window for batching frame delivery to clients. </p>
<p>Clients whose scheduled delivery times fall within this window of a captured frame will all receive the same frame. This reduces redundant captures and improves efficiency. </p>

<p class="definition">Definition at line <a class="el" href="../../d4/d4b/collector_8hpp_source.html#l00091">91</a> of file <a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>src/irsol/include/irsol/server/image_collector/<a class="el" href="../../d4/d4b/collector_8hpp_source.html">collector.hpp</a></li>
<li>src/irsol/lib/irsol/server/image_collector/<a class="el" href="../../db/d61/collector_8cpp_source.html">collector.cpp</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="../../d7/ddb/namespaceirsol.html">irsol</a></li><li class="navelem"><a class="el" href="../../d1/d03/namespaceirsol_1_1server.html">server</a></li><li class="navelem"><a class="el" href="../../d4/dd5/namespaceirsol_1_1server_1_1frame__collector.html">frame_collector</a></li><li class="navelem"><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html">FrameCollector</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
