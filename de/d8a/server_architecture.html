<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>IRSOL: Server Architecture</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="../../irsol_logo.jpeg"/></td>
  <td id="projectalign">
   <div id="projectname">IRSOL
   </div>
   <div id="projectbrief">C++ code implementing socket server for interacting with Baumer camera.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('de/d8a/server_architecture.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Server Architecture</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This document provides a thorough overview of the architecture of a running <code>irsol</code> server. It is intended for developers and users who are new to the project and want to understand how the application is structured, how its main components interact, and how client connections are managed.</p>
<h1>Overview</h1>
<p>The <code>irsol</code> server is designed to manage multiple client connections, coordinate access to a physical camera device, and distribute image frames to clients according to their requests. The architecture is modular, with clear separation of concerns between connection management, camera access, and message handling.</p>
<p>At the heart of the system is the <a class="el" href="../../db/dc5/classirsol_1_1server_1_1App.html">irsol::server::App</a> class, which acts as the central coordinator. Each client that connects to the server is managed by its own <a class="el" href="../../d2/d23/classirsol_1_1server_1_1ClientSession.html">irsol::server::ClientSession</a>, running in a dedicated thread. The <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html">irsol::server::frame_collector::FrameCollector</a> is responsible for acquiring images from the camera and distributing them to clients as needed.</p>
<h1>Main Components</h1>
<h2>App</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../db/dc5/classirsol_1_1server_1_1App.html" title="Main server application that manages client connections and camera streaming.">irsol::server::App</a><ul>
<li><b>Role:</b> The central application object, responsible <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> orchestrating all server activities.</li>
<li><b>Responsibilities:</b><ul>
<li>Starts and stops the server.</li>
<li>Owns the <a class="el" href="../../d0/da9/examples_200-logging-and-asserting_2main_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a> camera interface and the frame collector.</li>
<li>Maintains a registry of all active client sessions.</li>
<li>Provides access to shared resources <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> message handlers.</li>
<li>Broadcasts messages to all clients if needed.</li>
</ul>
</li>
</ul>
</dd></dl>
<h2>Acceptor</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d4/db5/classirsol_1_1server_1_1internal_1_1ClientSessionAcceptor.html" title="Accepts incoming TCP connections and triggers a callback for each new client.">irsol::server::internal::ClientSessionAcceptor</a><ul>
<li><b>Role:</b> Listens <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> incoming TCP connections from clients.</li>
<li><b>Responsibilities:</b><ul>
<li>Runs in its own thread.</li>
<li>Accepts new client connections.</li>
<li>For each new connection, creates a new <code>ClientSession</code> and hands off the socket.</li>
</ul>
</li>
</ul>
</dd></dl>
<h2>ClientSession</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d2/d23/classirsol_1_1server_1_1ClientSession.html" title="Represents a single connected client session.">irsol::server::ClientSession</a><ul>
<li><b>Role:</b> Represents a single connected client.</li>
<li><b>Responsibilities:</b><ul>
<li>Runs in its own thread, handling all communication with the client.</li>
<li>Reads and parses incoming messages.</li>
<li>Sends responses and image data back to the client.</li>
<li>Maintains private, per-client state (e.g., streaming preferences, session data).</li>
<li>Interacts with the central <a class="el" href="../../db/dc5/classirsol_1_1server_1_1App.html">irsol::server::App</a> and shared resources via message handlers.</li>
</ul>
</li>
<li><b>User Data:</b> Each <code>ClientSession</code> has its own <code>UserSessionData</code> structure, which holds all private state <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> that client, such as streaming parameters and thread control flags.</li>
</ul>
</dd></dl>
<h2>FrameCollector</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html" title="FrameCollector coordinates frame acquisition from a camera and distributes frames to registered clien...">irsol::server::frame_collector::FrameCollector</a><ul>
<li><b>Role:</b> Manages access to the physical camera and coordinates frame distribution.</li>
<li><b>Responsibilities:</b><ul>
<li>Runs a background thread to acquire images from the camera.</li>
<li>Maintains a schedule of which <a class="el" href="../../d2/d23/classirsol_1_1server_1_1ClientSession.html">irsol::server::ClientSession</a> need frames and at what rates.</li>
<li>Pushes frames into per-client queues as requested.</li>
<li>Ensures thread-safe access to the camera hardware.</li>
</ul>
</li>
</ul>
</dd></dl>
<h2>Camera Interface</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d7/d37/classirsol_1_1camera_1_1Interface.html" title="High-level wrapper around the NeoAPI camera for synchronized access.">irsol::camera::Interface</a><ul>
<li><b>Role:</b> Abstracts the physical camera device (e.g., Baumer camera).</li>
<li><b>Responsibilities:</b><ul>
<li>Provides methods to capture images, set parameters, and query camera status.</li>
<li>Used exclusively by the <a class="el" href="../../de/d26/classirsol_1_1server_1_1frame__collector_1_1FrameCollector.html">irsol::server::frame_collector::FrameCollector</a> to ensure safe, serialized access.</li>
</ul>
</li>
</ul>
</dd></dl>
<h2>Message Handlers</h2>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="../../d9/da2/namespaceirsol_1_1server_1_1handlers.html" title="Contains all logic for dispatching and implementing protocol message handlers.">irsol::server::handlers</a> </dd>
<dd>
<a class="el" href="../../d1/dbf/classirsol_1_1server_1_1handlers_1_1MessageHandler.html" title="Binds incoming protocol messages to the appropriate per-client logic.">irsol::server::handlers::MessageHandler</a><ul>
<li><b>Role:</b> Encapsulate the logic <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> processing protocol messages from clients.</li>
<li><b>Responsibilities:</b><ul>
<li>Each handler is responsible <a class="el" href="../../d4/dfd/test__utils_8cpp.html#a77f8aa12ac4b75e6cc18d26610639192">for</a> a specific type of message (e.g., frame requests, parameter changes).</li>
<li><a class="el" href="../../df/de1/group__Handlers.html" title="Provides the mapping between incoming protocol messages and application logic.">Handlers</a> have access to the central <a class="el" href="../../db/dc5/classirsol_1_1server_1_1App.html">irsol::server::App</a> and can interact with shared resources.</li>
<li>Enable modular and extensible message processing.</li>
</ul>
</li>
</ul>
</dd></dl>
<h1>Lifecycle of a Client Connection</h1>
<ol type="1">
<li><b>Startup:</b> The <code>App</code> starts the <code>Acceptor</code> on a specified TCP port.</li>
<li><b>Connection:</b> When a client connects, the <code>Acceptor</code> creates a new <code>ClientSession</code> and assigns it a unique ID.</li>
<li><b>Session Thread:</b> The <code>ClientSession</code> runs in its own thread, handling all communication with the client.</li>
<li><b>Message Processing:</b> Incoming messages are parsed and dispatched to the appropriate message handler. The message send by one client are parsed and processed by the <code>ClientSession</code> associated with that client.</li>
<li><b>Frame Requests:</b> If a client requests image frames, <code>ClientSession</code> registers itself in the <code>FrameCollector</code>, which in turn schedules and delivers frames to the client via a thread-safe queue.</li>
<li><b>Disconnection:</b> When a client disconnects, its <code>ClientSession</code> is cleaned up, and any resources (such as frame queues) are released.</li>
</ol>
<h1>Threading Model</h1>
<ul>
<li><b>App:</b> Main thread, coordinates startup and shutdown.</li>
<li><b>Acceptor:</b> Runs in a dedicated thread, accepting new connections. The <code>Acceptor</code> thread is owned by the <code>App</code>.</li>
<li><b>ClientSession:</b> Each client session runs in its own thread, ensuring that slow or blocked clients do not affect others. The <code>ClientSession</code> threads are detached on creation, and are automatically joined when the client disconnects from the server.</li>
<li><b>FrameCollector:</b> Runs a background thread to acquire and distribute frames.</li>
</ul>
<h1>Shared Resources and Synchronization</h1>
<ul>
<li>The <code>App</code> object and its associated resources (camera, frame collector) are shared among all client sessions.</li>
<li>Access to shared data structures (such as the client registry and frame schedules) is protected by mutexes.</li>
<li>Each <code>ClientSession</code> has its own private user data, ensuring that per-client state is isolated and thread-safe.</li>
</ul>
<h1>Summary Diagram</h1>
<p>Below is a simplified diagram illustrating the relationships between the main components:</p>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">| App               |</div>
<div class="line">| ----------------- |</div>
<div class="line">| - CameraInterface |</div>
<div class="line">| - FrameCollector  |</div>
<div class="line">| - Acceptor        |</div>
<div class="line">| - ClientSessions  |</div>
<div class="line">+---+---+---+---+---+</div>
<div class="line">        |   |   |</div>
<div class="line">        |   |   +-------------------+</div>
<div class="line">        |   +-------------------+   |</div>
<div class="line">        +-------------------+   |   |</div>
<div class="line">                            |   |   |</div>
<div class="line">                        +---v---v---v---+</div>
<div class="line">                        | ClientSession |</div>
<div class="line">                        +---------------+</div>
<div class="line">                        | UserSession   |</div>
<div class="line">                        | (private data)|</div>
<div class="line">                        +---------------+</div>
</div><!-- fragment --><ul>
<li>The <code>App</code> owns the camera interface, frame collector, and acceptor.</li>
<li>Each <code>ClientSession</code> is created by the acceptor and runs in its own detached thread.</li>
<li>The <code>FrameCollector</code> manages access to the camera and distributes frames to clients via a queue.</li>
<li>Message handlers provide the logic for processing client requests and interact with the <code>App</code>. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
